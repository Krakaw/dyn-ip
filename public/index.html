<!doctype html>
<html>
<head>
    <style>

    </style>
    <title>dyn-ip</title>
</head>
<body>
<section>
    <table>
        <thead>
        <tr>
            <th>Add New Domain</th>
            <th><input placeholder="Subdomain" type="text"/></th>
            <th><input placeholder="ip" type="text"/></th>
            <th><button>Create</button></th>
        </tr>
        <tr>
            <th>Domain</th>
            <th>Id</th>
            <th>Ip</th>
            <th>&nbsp;</th>
        </tr>

        </thead>
        <tbody id="body">

        </tbody>
    </table>
</section>
<script>

    async function getDomains() {
        const result = await fetch('/api/domains');
        const domains = await result.json();
        return domains;
    }

    function deleteDomain(id) {
        fetch(`/api/domains/${id}`, {
            method: 'DELETE'
        }).then(r => {
            console.log(r);
            init();
        })
    }
    function generateRows(domains) {
        const body = document.getElementById('body');
        body.innerHTML = '';
        domains.forEach(domain => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${domain.domain}</td><td>${domain.id}</td><td>${domain.ip}</td><td><button onclick="deleteDomain('${domain.id}')">X</button></td>`;
            body.appendChild(row);
        })
    }

    function init() {
        const body = document.getElementById('body');
        body.innerHTML = '<tr><td colspan="4">Loading...</td>';
        getDomains().then(domains => {
            generateRows(domains)
        });
    }
    init();
</script>
</body>
</html>
