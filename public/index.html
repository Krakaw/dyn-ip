<!doctype html>
<html>
<head>
    <style>
        table.styled-table {
            border-collapse: collapse;
            margin: 0px 0px 25px 0;
            font-size: 0.9em;
            font-family: sans-serif;
            /*min-width: 400px;*/
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
        }

        table.styled-table.sticky thead tr:not(.no-sticky) {
            position: sticky;
            top: 0;
            z-index: 2;
        }

        table.styled-table thead tr {
            background-color: #009879;
            color: #ffffff;
            text-align: left;
        }

        table.styled-table th,
        table.styled-table td {
            padding: 12px 15px;
        }

        table.no-height-fill.styled-table td {
            padding: 5px;
        }

        table.no-height-fill.styled-table td, table.no-height-fill.styled-table tr {
            display: block;
        }

        table.styled-table td:first-of-type {
            padding: 3px;
        }

        table.styled-table tbody tr {
            border-bottom: 1px solid #dddddd;

        }

        table.styled-table tbody tr.loading, table.styled-table tbody td.loading {
            opacity: 0.6;
        }

        table.styled-table tbody tr.error {
            color: #ff5555;
            opacity: 0.8;
        }

        table.styled-table tbody tr:nth-of-type(even) {
            background-color: #f3f3f3;
        }

        table.styled-table tbody tr:last-of-type {
            border-bottom: 2px solid #009879;
        }


        table.styled-table tbody tr.active-row {
            font-weight: bold;
            color: #009879;
        }

    </style>
    <title>dyn-ip</title>
</head>
<body>
<section>
    <table style="width: 100%" class="styled-table sticky">
        <thead>
        <tr>
            <th>Add New Domain</th>
            <th><input placeholder="Subdomain" type="text"/></th>
            <th><input placeholder="ip" type="text"/></th>
            <th><button>Create</button></th>
        </tr>
        <tr>
            <th>Domain</th>
            <th>Id</th>
            <th>Ip</th>
            <th>&nbsp;</th>
        </tr>

        </thead>
        <tbody id="body">

        </tbody>
    </table>
</section>
<script>

    async function getDomains() {
        const result = await fetch('/api/domains');
        const domains = await result.json();
        return domains;
    }

    function deleteDomain(id) {
        fetch(`/api/domains/${id}`, {
            method: 'DELETE'
        }).then(r => {
            console.log(r);
            init();
        })
    }
    function generateRows(domains) {
        const body = document.getElementById('body');
        body.innerHTML = '';
        domains.forEach(domain => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${domain.domain}</td><td>${domain.id}</td><td>${domain.ip}</td><td><button onclick="deleteDomain('${domain.id}')">X</button></td>`;
            body.appendChild(row);
        })
    }

    function init() {
        const body = document.getElementById('body');
        body.innerHTML = '<tr><td colspan="4">Loading...</td>';
        getDomains().then(domains => {
            generateRows(domains)
        });
    }
    init();
</script>
</body>
</html>
